<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Step by step tutorial: Create HEC-RAS 2D Geometry &mdash; RiverGIS 0.15 alpha documentation</title>
    
    <link rel="stylesheet" href="_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.15 alpha',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="RiverGIS 0.15 alpha documentation" href="index.html" />
    <link rel="next" title="Create 2D Areas" href="create2darea.html" />
    <link rel="prev" title="Installation of required Python packages" href="install_req.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="create2darea.html" title="Create 2D Areas"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="install_req.html" title="Installation of required Python packages"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">RiverGIS 0.15 alpha documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="step-by-step-tutorial-create-hec-ras-2d-geometry">
<span id="stepbystep2d"></span><h1>Step by step tutorial: Create HEC-RAS 2D Geometry<a class="headerlink" href="#step-by-step-tutorial-create-hec-ras-2d-geometry" title="Permalink to this headline">¶</a></h1>
<p>Required data:</p>
<ol class="arabic simple">
<li>Flow area(s) shape &#8212; a polygon layer with a name and a mesh spacing attributes.</li>
<li>DTM, digital terrain model &#8212; a raster layer.</li>
</ol>
<p>Optional data:</p>
<ol class="arabic simple" start="3">
<li>Structure lines &#8212; a polyline layer. You only need it, when 2D mesh should be aligned to a flow controlling structure like a levee or embankment.</li>
<li>Structure breakpoints &#8212; a point layer. By default the mesh cell size at structures is given by an attribute of the structure line. If you need a variable mesh spacing or a cell face placed exactly at a location, you need breakpoints.</li>
<li>Land cover &#8212; a polygon layer. HEC-RAS will use it to calculate mesh cells roughness.</li>
</ol>
<div class="section" id="step-0-install-qgis-postgis-and-the-rivergis-plugin">
<h2>Step 0. Install QGIS, PostGIS and the RiverGIS plugin<a class="headerlink" href="#step-0-install-qgis-postgis-and-the-rivergis-plugin" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This short subsection is Windows oriented, as most of the HEC-RAS users use this operating system. However, installing QGIS and PostGIS on GNU/Linux systems is not only possible, but much easier.</p>
</div>
<ol class="arabic simple">
<li>If you need to install PostGIS, please refer to <a class="reference external" href="http://postgis.net/windows_downloads">Windows download section of PostGIS website</a>.</li>
<li>Install QGIS with <a class="reference external" href="http://download.osgeo.org/osgeo4w/osgeo4w-setup-x86.exe">OSGeo4W installer</a>. Use the &#8216;Advanced&#8217; type of installation and from the list of packages select <em class="menuselection">Desktop ‣ qgis</em>. This will install current stable version of QGIS and all other required packages.</li>
<li>Install RiverGIS plugin: <em class="menuselection">Plugins ‣ Manage and install plugins...</em>. Search for <tt class="file docutils literal"><span class="pre">RiverGIS</span></tt> and click <strong class="command">Install</strong> button.</li>
</ol>
</div>
<div class="section" id="step-1-create-load-required-data">
<h2>Step 1. Create/load required data<a class="headerlink" href="#step-1-create-load-required-data" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">QGIS User Manual <a class="reference external" href="http://docs.qgis.org/2.6/en/docs/user_manual/working_with_raster/supported_data.html">Loading raster data</a> and <a class="reference external" href="http://docs.qgis.org/2.6/en/docs/user_manual/working_with_vector/supported_data.html">Loading vector data in QGIS</a> is an excellent start point for QGIS beginners.</p>
</div>
<ol class="arabic simple">
<li><strong>Start from saving QGIS project</strong> in a favourite directory <em class="menuselection">Project ‣ Save</em></li>
<li><strong>Load a raster of digital terrain model (DTM)</strong>. Below you can see a DTM with a hillshade as an overlay (<a class="reference external" href="http://docs.qgis.org/2.6/en/docs/training_manual/rasters/terrain_analysis.html?highlight=hillshade">see QGIS Training Manual</a>).</li>
</ol>
<blockquote>
<div><div class="figure align-center" id="fig-sbs-loaddtm">
<img alt="_images/sbs02.png" src="_images/sbs02.png" />
<p class="caption">DTM and hillshade overlay loaded into QGIS project</p>
</div>
</div></blockquote>
<ol class="arabic simple" start="3">
<li><strong>Create a 2D Flow Areas</strong> polygon layer (<em class="menuselection">Layer ‣ Create Layer ‣ New Shapefile Layer...</em>) with required fields:</li>
</ol>
<blockquote>
<div><ul class="simple">
<li>name of 2D Flow Area (text) and</li>
<li>cell size (whole number) &#8212; a default mesh points spacing in layer&#8217;s CRS units.</li>
</ul>
<p>The layer&#8217;s <abbr title="Coordinate Reference System">CRS</abbr> should be identical with DTM&#8217;s CRS. See <a class="reference external" href="http://docs.qgis.org/2.6/en/docs/training_manual/create_vector_data/create_new_vector.html#basic-fa-the-layer-creation-dialog">QGIS Training Manual</a> for creating vector layer details. Finally, <strong>change the layer&#8217;s rendering style</strong> by double clicking the layer in the legend tree (<a class="reference external" href="http://docs.qgis.org/2.6/en/docs/user_manual/working_with_vector/vector_properties.html#style-menu">ref</a>).</p>
<div class="figure align-center" id="fig-sbs-create2dflowarealayer">
<img alt="_images/sbs03.png" src="_images/sbs03.png" />
<p class="caption">Create 2D Flow Areas polygon layer</p>
</div>
</div></blockquote>
<ol class="arabic simple" start="4">
<li><strong>Create structure lines layer</strong> with required fields:</li>
</ol>
<blockquote>
<div><ul class="simple">
<li>cell size (whole number) &#8212; a default mesh points spacing along the structure</li>
<li>mesh rows (whole number) &#8212; a number of mesh rows that should be aligned to the structure</li>
</ul>
<p>Again, the layer&#8217;s <abbr title="Coordinate Refernece System">CRS</abbr> should be identical with DTM&#8217;s CRS. <strong>Change the layer&#8217;s rendering style</strong> by double clicking the layer in the legend tree.</p>
<div class="figure align-center" id="fig-sbs-createstructurelineslayer">
<img alt="_images/sbs04.png" src="_images/sbs04.png" />
<p class="caption">Create structure lines layer</p>
</div>
</div></blockquote>
<ol class="arabic simple" start="5">
<li><strong>Digitize 2D Flow Area</strong>.</li>
</ol>
<blockquote>
<div><div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><a class="reference external" href="http://docs.qgis.org/2.6/en/docs/user_manual/working_with_vector/editing_geometry_attributes.html">QGIS User Manual</a> has extensive part on vector layers editing.</p>
</div>
<p>In the legend window select the 2D flow areas layer and toggle editing mode by clicking <img alt="toggle_editting" src="_images/mActionToggleEditing.png" /> button, then <img alt="capture_polygon" src="_images/mActionCapturePolygon.png" /> and <strong>capture your 2D flow area polygon</strong> clicking on its vertices. Finish drawing with right click.</p>
<div class="figure align-center" id="fig-sbs-create2dareapolygon">
<img alt="_images/sbs05.png" src="_images/sbs05.png" />
<p class="caption">Digitize 2D flow area polygon</p>
</div>
<p>Depending on your QGIS setup, you can have attribute form displayed right after digitizing or you will have to open layer&#8217;s attribute table to <strong>define the attributes</strong>.</p>
<div class="figure align-center" id="fig-sbs-create2dareaattributes">
<img alt="_images/sbs06.png" src="_images/sbs06.png" />
<p class="caption">Define 2D flow area attributes</p>
</div>
<p>After the attributes are defined toggle the editing mode with <img alt="toggle_editting" src="_images/mActionToggleEditing.png" /> button and save the changes. Now we have complete 2d flow area shape with the name &#8216;My First Area&#8217; and the default mesh points spacing 100 meters.</p>
</div></blockquote>
<ol class="arabic simple" start="6">
<li><strong>Digitize structure lines</strong>.</li>
</ol>
<blockquote>
<div><p>In the legend window select the structure lines layer and toggle edit mode, then click <img alt="capture_line" src="_images/mActionCaptureLine.png" /> button and start capture a structure line by clicking its vertices. In this example we would like to have two structures defined:</p>
<ul class="simple">
<li><strong>levee</strong> on the right side of the main channel: we don&#8217;t want the flow to go through the levee, so we have to align cell faces to the levee centerline. Please, refer to the HEC-RAS 5.0 documentation on creating 2d flow areas for detailed explanation. We would like the mesh spacing be a little bit finer</li>
<li><strong>the main channel</strong> itself: having 100 meters mesh spacing on floodplain is fine, but for the main channel we would like to have much finer cells, say 40 meters. The channel is wider than 40 meters, so we would need to align a few rows of the mesh to the river centerline &#8212; let&#8217;s check 3 rows.</li>
</ul>
<div class="figure align-center" id="fig-sbs-create2dareastucturelines">
<img alt="_images/sbs07.png" src="_images/sbs07.png" />
<p class="caption">Digitize structure line</p>
</div>
<p>Fill in the attributes:</p>
<div class="figure align-center" id="fig-sbs-createstructurelineattributes">
<img alt="_images/sbs08.png" src="_images/sbs08.png" />
<p class="caption">Define structure lines attributes</p>
</div>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><a class="reference external" href="http://rivergis.com/tut_create_2g_geom_lyrs.7z">Download the above vector layers from rivergis.com</a></p>
</div>
</div>
<div class="section" id="step-2-create-2d-flow-area">
<h2>Step 2. Create 2D Flow Area<a class="headerlink" href="#step-2-create-2d-flow-area" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li><strong>Select PostGIS connection and schema</strong></li>
</ol>
<blockquote>
<div><p>Open RiverGIS plugin main window. Creating the mesh requires an active connection to a PostGIS database. Please refer to <a class="reference external" href="http://docs.qgis.org/2.6/en/docs/user_manual/working_with_vector/supported_data.html#creating-a-stored-connection">QGIS User Manual for creating PostGIS connection description</a>.</p>
<div class="figure align-center" id="fig-sbs-rivergisconnschemaselected">
<img alt="_images/sbs10.png" src="_images/sbs10.png" />
<p class="caption">RiverGIS plugin main window and connection/schema selection</p>
</div>
<p>After you have defined a connection, you should be able to select it in the Connections tree of the RiverGIS. Every newly created PostgreSQL database has a public schema, which we can use for storing our data, but it is advisable to create a new schema for each case. We would like to <strong>create a new schema</strong> &#8216;my_first_2d_geom&#8217; and we do this in DB Manager plugin (<em class="menuselection">Schema ‣ Create schema</em>).</p>
</div></blockquote>
<ol class="arabic simple" start="2">
<li><strong>Create the model geometry</strong></li>
</ol>
<blockquote>
<div><p>Having the connection and schema selected we can create the geometry from the RiverGIS menu <em class="menuselection">2D Geometry ‣ Create 2D Flow Areas</em>. Set the parameters of the tool and click <strong class="command">OK</strong> button.</p>
<div class="figure align-center" id="fig-sbs-create2dflowareaparams">
<img alt="_images/sbs09.png" src="_images/sbs09.png" />
<p class="caption">Create 2D Flow Area parameters dialog window</p>
</div>
</div></blockquote>
<ol class="arabic simple" start="3">
<li><strong>Preview the mesh</strong></li>
</ol>
<blockquote>
<div><p>If the 2D flow area creation was successful, we should be able to preview the mesh. First, let&#8217;s try to <strong>load the mesh points to QGIS</strong>: expand the schema in the Connections tree, right click the <tt class="file docutils literal"><span class="pre">mesh_pts</span></tt> database table and add it to the map canvas.</p>
<div class="figure align-center" id="fig-sbs-addmeshptstocanvas">
<img alt="_images/sbs11.png" src="_images/sbs11.png" />
<p class="caption">Add mesh points to the map canvas</p>
</div>
<div class="figure align-center" id="fig-sbs-meshptsaddedtocanvas">
<img alt="_images/sbs13.png" src="_images/sbs13.png" />
<p class="caption">Mesh points added to the map canvas</p>
</div>
</div></blockquote>
</div>
<div class="section" id="step-3-import-the-geometry-to-hec-ras">
<h2>Step 3. Import the geometry to HEC-RAS<a class="headerlink" href="#step-3-import-the-geometry-to-hec-ras" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li>To <strong>preview the geometry in HEC-RAS</strong>, from the main HEC-RAS window run <em class="menuselection">File ‣ Import HEC-RAS data...</em> and choose the geometry created by RiverGIS.</li>
</ol>
<blockquote>
<div><div class="figure align-center" id="fig-sbs-previewmeshgeometry">
<img alt="_images/sbs12.png" src="_images/sbs12.png" />
<p class="caption">Preview 2D Flow Area in HEC-RAS Geometry Data editor</p>
</div>
</div></blockquote>
<ol class="arabic simple" start="2">
<li><strong>Preview the mesh in RAS Mapper</strong></li>
</ol>
<blockquote>
<div><div class="figure align-center" id="fig-sbs-previewmeshrasmapper">
<img alt="_images/sbs14.png" src="_images/sbs14.png" />
<p class="caption">Preview 2D Flow Area mesh in RAS Mapper</p>
</div>
</div></blockquote>
</div>
<div class="section" id="step-4-check-the-mesh">
<h2>Step 4. Check the mesh<a class="headerlink" href="#step-4-check-the-mesh" title="Permalink to this headline">¶</a></h2>
<p>Let&#8217;s have a closer look at the generated mesh.</p>
<div class="figure align-center" id="fig-sbs-checkmesh">
<img alt="_images/sbs09.jpg" src="_images/sbs09.jpg" />
<p class="caption">Details of the generated mesh</p>
</div>
<p>What we would like to change in the mesh:</p>
<ul class="simple">
<li>Some groins miss a cell face (red arrows) &#8212; cell faces are placed at equal distance, but groins are not. We need a variable mesh spacing. We will achieve this by constructing <strong>breakpoints</strong> at which a cell face is required.</li>
<li>Decrease a little bit the mesh spacing at the right levee.</li>
</ul>
<p>This will result in the following:</p>
<div class="figure align-center" id="fig-sbs-checkedmesh">
<img alt="_images/sbs15.jpg" src="_images/sbs15.jpg" />
<p class="caption">Main channel mesh aligned with breakpoints (orange points)</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Step by step tutorial: Create HEC-RAS 2D Geometry</a><ul>
<li><a class="reference internal" href="#step-0-install-qgis-postgis-and-the-rivergis-plugin">Step 0. Install QGIS, PostGIS and the RiverGIS plugin</a></li>
<li><a class="reference internal" href="#step-1-create-load-required-data">Step 1. Create/load required data</a></li>
<li><a class="reference internal" href="#step-2-create-2d-flow-area">Step 2. Create 2D Flow Area</a></li>
<li><a class="reference internal" href="#step-3-import-the-geometry-to-hec-ras">Step 3. Import the geometry to HEC-RAS</a></li>
<li><a class="reference internal" href="#step-4-check-the-mesh">Step 4. Check the mesh</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="install_req.html"
                        title="previous chapter">Installation of required Python packages</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="create2darea.html"
                        title="next chapter">Create 2D Areas</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/stepByStep2d.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="create2darea.html" title="Create 2D Areas"
             >next</a> |</li>
        <li class="right" >
          <a href="install_req.html" title="Installation of required Python packages"
             >previous</a> |</li>
        <li><a href="index.html">RiverGIS 0.15 alpha documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2015, RiverGIS.com.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.3.
    </div>
  </body>
</html>